#!/bin/bash

${WGET} http://www.quantum-simulation.org/potentials/sg15_oncv/upf/C_ONCV_PBE-1.0.upf
${WGET} http://www.quantum-simulation.org/potentials/sg15_oncv/upf/N_ONCV_PBE-1.0.upf

cat > pw.in << EOF
&CONTROL
calculation  = 'scf'
restart_mode = 'from_scratch'
pseudo_dir   = './'
outdir       = './'
prefix       = 'test'
wf_collect   = .true.
/
&SYSTEM
ibrav             = 0
ecutwfc           = 25
tot_charge        = -1
nspin             = 2
tot_magnetization = 2.
nbnd              = 144
nat               = 63
ntyp              = 2
/
&ELECTRONS
conv_thr       = 1D-8
diago_full_acc = .true.
/
K_POINTS gamma
CELL_PARAMETERS angstrom
7.136000  0.000000  0.000000
0.000000  7.136000  0.000000
0.000000  0.000000  7.136000
ATOMIC_SPECIES
C  12.01099968  C_ONCV_PBE-1.0.upf
N  14.00699997  N_ONCV_PBE-1.0.upf
ATOMIC_POSITIONS crystal
C    0.124720021966    0.372675863577    0.375872907420
C    0.125779199178    0.375849923669    0.873254981893
C    0.125840943585    0.874138508673    0.374998484869
C    0.125514319209    0.875702219032    0.874245445901
C    0.623644414549    0.378253899590    0.376722636459
C    0.624667806268    0.370328370659    0.874555639605
C    0.624248999391    0.876392067436    0.375551259467
C    0.624853735937    0.873540621229    0.874060399947
C    0.000986328316    0.000817250017   -0.000865033354
C   -0.000920630094   -0.000859224516    0.500060426588
C   -0.000897386436    0.499891241173    0.000848572643
C    0.000653041284    0.499876264810    0.500093494649
C    0.499839619145   -0.001222152484    0.001231229717
C    0.499143884159    0.001793621115    0.501610461434
C    0.499189205490    0.498395989299   -0.001770364026
C    0.125523068819    0.125636341759    0.124286934956
C    0.125736505241    0.126707876278    0.624073449644
C    0.125870152161    0.624955582822    0.125842763315
C    0.124760395595    0.624098642171    0.627258905772
C    0.624821569339    0.125986588187    0.126481979636
C    0.624625730212    0.125494071208    0.629691069317
C    0.624254880620    0.624449544937    0.123640001937
C    0.623685267905    0.623337983071    0.621776313847
C   -0.001312320549    0.251346286240    0.248391052942
C    0.000226342132    0.250559611624    0.749388382569
C    0.000577460841    0.750332041792    0.249647788414
C   -0.001269462505    0.751638858247    0.748622760731
C    0.498190000207    0.252062187187    0.252005183736
C    0.515304788039    0.236796792155    0.763263192158
C    0.500294033540    0.750960809038    0.249038801402
C    0.498242384263    0.748036039923    0.747957783183
C    0.374894991679    0.374918700116    0.124523591405
C    0.374636039163    0.874010673677    0.125967978954
C    0.374893396609    0.875483145005    0.625063523697
C    0.874907461618    0.374911515751    0.126010283623
C    0.874767906421    0.374867246417    0.625129243850
C    0.875024487383    0.875508549648    0.124502831842
C    0.874935781699    0.874032048552    0.625122644976
C    0.250645872920   -0.000650792490    0.248952111983
C    0.251319053372    0.001336634260    0.749077161846
C    0.251328534453    0.498516141011    0.251840207997
C    0.236912751737    0.511194617417    0.759366122598
C    0.749629479041    0.001056522997    0.250303226468
C    0.752077605657   -0.002200185064    0.749109110282
C    0.750841739217    0.500857111901    0.248703572902
C    0.748545594158    0.497951994695    0.748591257754
C    0.372747661960    0.127818726790    0.378027609619
C    0.378020111842    0.126583344264    0.873403466337
C    0.378143124464    0.623245035447    0.376762800359
C    0.372827934762    0.621983976099    0.872186706771
C    0.873870191821    0.126134689199    0.375229966783
C    0.875538358274    0.124939952911    0.875074360443
C    0.875601488830    0.625139596599    0.374864724254
C    0.873896467091    0.624768427618    0.873866268749
C    0.251357054018    0.250857911975   -0.001349288789
C    0.236855810095    0.240636787733    0.488791261703
C    0.250676711736    0.751022538424    0.000613816989
C    0.251333798309    0.748164737268    0.501444385538
C    0.752069163500    0.250935767659    0.002235028046
C    0.748522250534    0.251427534432    0.502073481823
C    0.749643044368    0.749692127769   -0.001012600304
C    0.750869519938    0.751340823228    0.499160980396
N    0.510869487786    0.510534886303    0.489526927897
EOF

cat > wbse.in << EOF
input_west:
  qe_prefix: test
  west_prefix: test
  outdir: ./

wbse_init_control:
  wbse_init_calculation: S
  solver: TDDFT

wbse_control:
  wbse_calculation: D
  n_liouville_eigen: 2
  n_liouville_times: 20
  trev_liouville: 0.00000001
  trev_liouville_rel: 0.000001
  l_pre_shift: False 
  l_forces: True
  forces_state: 1
EOF
